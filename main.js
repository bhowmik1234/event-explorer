const hackathonData = {
    "ZenHack 2024": {
        name: "ZenHack 2024",
        image: "https://d112y698adiu2z.cloudfront.net/photos/production/challenge_thumbnails/002/924/909/datas/medium_square.png",
        description:
            "A hackathon catered toward the new generation of innovators, High School Students, focused on improving the world for the better through innovative projects.",
        eligibility: [
            "Ages 13+ only",
            "High school students only",
            "All countries/territories, excluding standard exceptions",
        ],
        about: "We're Zenith, an organization dedicated to promoting the next generation of innovators, high school students, and we've decided to create this hackathon to allow students to get a taste of building something for themselves, along with their peers, while being supervised by industry professional mentors, and of course, free food.",
    },
    "HackUNCP 2024": {
        name: "HackUNCP 2024",
        image: "https://d112y698adiu2z.cloudfront.net/photos/production/challenge_thumbnails/003/020/931/datas/medium_square.jpg",
        description:
            "Join us for 24 hours of coding, creativity, and innovation at the University of North Carolina at Pembroke.",
        eligibility: [
            "College students only",
            "Must be 18+ years old",
            "Valid student ID required",
        ],
        about: "HackUNCP is the premier hackathon at UNCP, bringing together students from all backgrounds to create, innovate, and learn from each other in a collaborative environment.",
    },
    "hackUMBC Fall 2024": {
        name: "hackUMBC Fall 2024",
        image: "https://d112y698adiu2z.cloudfront.net/photos/production/challenge_photos/003/034/790/datas/full_width.png",
        description:
            "The largest collegiate hackathon in Maryland, bringing together innovators from across the region.",
        eligibility: [
            "All university students welcome",
            "Recent graduates (within 1 year)",
            "Must be 18+ years old",
        ],
        about: "hackUMBC is more than just a hackathon - it's a celebration of technology, creativity, and collaboration. Join us for 36 hours of hacking, workshops, and fun!",
    },
    "BevHacks 2025": {
        name: "BevHacks 2025",
        image: "https://d112y698adiu2z.cloudfront.net/photos/production/challenge_photos/003/092/857/datas/full_width.png",
        description:
            "A unique hackathon focused on innovating the beverage industry through technology.",
        eligibility: [
            "Open to all developers",
            "Must be 21+ years old",
            "Industry professionals welcome",
        ],
        about: "BevHacks brings together tech enthusiasts and beverage industry experts to create innovative solutions for the future of beverages.",
    },
    "TAMU Datathon 2024": {
        name: "TAMU Datathon 2024",
        image: "https://d112y698adiu2z.cloudfront.net/photos/production/challenge_thumbnails/003/120/802/datas/medium_square.png",
        description:
            "Texas A&M's premier data science competition, focusing on real-world data challenges.",
        eligibility: [
            "All university students",
            "Data science enthusiasts",
            "No experience required",
        ],
        about: "Join us for 48 hours of data analysis, machine learning, and visualization challenges. Learn from industry experts and showcase your skills!",
    },
    "GitHub Copilot": {
        name: "GitHub Copilot",
        image: "https://d112y698adiu2z.cloudfront.net/photos/production/challenge_photos/003/095/056/datas/full_width.png",
        description:
            "Empowering the Next Generation of Developers with GitHub and Azure",
        eligibility: [
            "All university students",
            "Data science enthusiasts",
            "No experience required",
        ],
        about:  `
        <p style="font-size: 16px; line-height: 1.6;">
          Get ready to dive deep into the world of AI-powered coding with the 
          <strong style="color: #f5a623;">GitHub Universe Learning Challenge</strong>!
        </p>
        <p style="font-size: 16px; line-height: 1.6;">
          Through this challenge, you'll gain hands-on experience with 
          <em style="font-style: italic; color: #7d4cdb;">GitHub Copilot</em>, your coding companion.
          GitHub Copilot provides code suggestions, completes functions, and even generates entire blocks of code based on your natural language prompts.
        </p>
        <ul style="padding-left: 20px; font-size: 16px;">
          <li style="margin: 8px 0;">Step 1: Sign up and complete the GitHub Universe Learning Challenge.</li>
          <li style="margin: 8px 0;">Step 2: Sign up for a free trial of GitHub Copilot.</li>
          <li style="margin: 8px 0;">Step 3: Build and submit an app leveraging Azure services.</li>
        </ul>
      `,
    },

    "Google Photorealistic 3D Maps": {
        name: "Google Photorealistic 3D Maps",
        image: "https://d112y698adiu2z.cloudfront.net/photos/production/challenge_photos/003/029/303/datas/full_width.png",
        description:
            "Build a new dimension of web experiences with 3D Maps for JavaScript developers",
        eligibility: [
            "All university students",
            "Data science enthusiasts",
            "No experience required",
        ],
        about:  `
        <p style="font-size: 16px; line-height: 1.6;">
          At <strong style="color: #1a73e8;">Google I/O 2024</strong>, the Google Maps Platform team launched an 
          experimental release of <strong>Photorealistic 3D Maps</strong> in the <em>Maps JavaScript API</em>, providing 
          developers with a photorealistic, real-world canvas to build on. Powered by Google’s advanced rendering technology, 
          these maps allow for <strong>3D mapping experiences</strong> that meet user expectations for speed and realism.
        </p>
        <p style="font-size: 16px; line-height: 1.6;">
          Designed as a <strong>web component</strong>, Photorealistic 3D Maps integrate easily into the 
          <em>Maps JavaScript API</em>, streamlining web development and offering flexibility for innovative designs.
        </p>
        <h3 style="color: #34a853; font-size: 18px; margin-top: 20px;">Categories</h3>
        <ul style="padding-left: 20px; font-size: 16px; line-height: 1.6;">
          <li style="margin: 8px 0;">
            <strong>Location Discovery:</strong> Reimagine ways to explore and interact with the world around us. 
            Create solutions that go beyond traditional navigation and make discovering new places and hidden spots easier.
          </li>
          <li style="margin: 8px 0;">
            <strong>Immersive Marketing:</strong> Use 3D Maps to build captivating marketing experiences. 
            Design campaigns that blend seamlessly with the real world and offer interactive storytelling.
          </li>
          <li style="margin: 8px 0;">
            <strong>Built Environment & Sustainability:</strong> Visualize urban environments in 3D to create 
            sustainable solutions. Tackle challenges related to urban planning, transportation, and environmental impact.
          </li>
        </ul>
        <p style="font-size: 16px; line-height: 1.6;">
          Explore the <a href="https://developers.google.com/maps/documentation/javascript/3d-maps" 
          style="color: #1a73e8; text-decoration: underline;">3D Maps JavaScript documentation</a> and 
          <a href="https://developers.google.com/maps/documentation/javascript/examples" 
          style="color: #1a73e8; text-decoration: underline;">Code Samples</a> for more details and code examples to get started.
        </p>
      `,
    },

    "Red Hat and Intel AI Hackathon": {
        name: "Red Hat and Intel AI Hackathon",
        image: "https://d112y698adiu2z.cloudfront.net/photos/production/challenge_photos/002/998/156/datas/full_width.png",
        description:
            "Embark on an Odyssey of Innovation: The Red Hat and Intel AI Hackathon Awaits!",
        eligibility: [
            "All university students",
            "Data science enthusiasts",
            "No experience required",
        ],
        about: "Join us for 48 hours of data analysis, machine learning, and visualization challenges. Learn from industry experts and showcase your skills!",
    },

    "Lightning Fast AI Hackathon": {
        name: "Lightning Fast AI Hackathon",
        image: "https://d112y698adiu2z.cloudfront.net/photos/production/challenge_photos/003/041/795/datas/full_width.jpg",
        description:
            "Build the AI agents of the future by taking advantage of SambaNova’s Lightning Fast Inference Speeds of Today",
        eligibility: [
            "All university students",
            "Data science enthusiasts",
            "No experience required",
        ],
        about: "Join us for 48 hours of data analysis, machine learning, and visualization challenges. Learn from industry experts and showcase your skills!",
    },

    "HackEPS 2024": {
        name: "HackEPS 2024",
        image: "https://d112y698adiu2z.cloudfront.net/photos/production/challenge_photos/003/106/156/datas/full_width.jpg",
        description:"The Hackathon of the lands of Lleida! ",
        eligibility: [
            "All university students",
            "Data science enthusiasts",
            "No experience required",
        ],
        about: "Join us for 48 hours of data analysis, machine learning, and visualization challenges. Learn from industry experts and showcase your skills!",
    },
};

function showCategory(category) {
    const buttons = document.querySelectorAll(".toggle-button");
    buttons.forEach((button) => button.classList.remove("active"));
    document
        .querySelector(`.toggle-button[onclick="showCategory('${category}')"]`)
        .classList.add("active");

    document
        .getElementById("events-locations")
        .classList.toggle("hidden", category !== "events");
    document
        .getElementById("hackathons-locations")
        .classList.toggle("hidden", category !== "hackathons");
}

let map3DElement = null;
let currentMarker = null;
let currentPolygon = null;
let data = null;
let currentModel = null;
let spinInterval = null;

async function init() {
    const { Map3DElement } = await google.maps.importLibrary("maps3d");
    map3DElement = new Map3DElement({
        center: { lat: 0, lng: 0, altitude: 20000000 },
    });
    document.getElementById("map-container").append(map3DElement);
    initAutocomplete();
}

async function initAutocomplete() {
    const { Autocomplete } = await google.maps.importLibrary("places");
    const autocomplete = new Autocomplete(
        document.getElementById("pac-input"),
        {
            fields: ["geometry", "name", "place_id"],
        }
    );
    autocomplete.addListener("place_changed", () => {
        const place = autocomplete.getPlace();
        if (!place.geometry || !place.geometry.viewport) {
            window.alert("No viewport for input: " + place.name);
            return;
        }
        zoomToViewport(place.geometry);
    });
}

const zoomToViewport = async (geometry, name, lat, lng) => {
    const { AltitudeMode, Model3DElement } = await google.maps.importLibrary("maps3d");
    const viewport = geometry.viewport;
    map3DElement.tilt = 67.5;

    // Remove previous marker and polygon if they exist
    if (currentModel) {
        map3DElement.removeChild(currentModel);
    }
    if (currentPolygon) {
        map3DElement.removeChild(currentPolygon);
    }

    // Center point for placing the 3D model
    const centerLat =
        (viewport.getNorthEast().lat() + viewport.getSouthWest().lat()) / 2;
    const centerLng =
        (viewport.getNorthEast().lng() + viewport.getSouthWest().lng()) / 2;
    const centerPoint = { lat: centerLat, lng: centerLng };

    // Calculate hexagon coordinates
    const radiusInMeters = 400;
    const earthRadius = 6371000;

    const hexagonCoordinates = Array.from({ length: 6 }, (_, i) => {
        const angle = i * 60 * (Math.PI / 180);
        const dLat = (radiusInMeters / earthRadius) * Math.cos(angle);
        const dLng =
            (radiusInMeters /
                (earthRadius * Math.cos((centerLat * Math.PI) / 180))) *
            Math.sin(angle);

        return {
            lat: centerLat + dLat * (180 / Math.PI),
            lng: centerLng + dLng * (180 / Math.PI),
        };
    });

    // Create a polygon element for the hexagon
    const polygonElement = document.createElement("gmp-polygon-3d");
    polygonElement.setAttribute("height", "100");
    polygonElement.setAttribute("altitude-mode", "clamp-to-ground");
    polygonElement.setAttribute("stroke-color", "#ffa500"); // Outline color
    polygonElement.setAttribute("stroke-width", "20");
    polygonElement.setAttribute("fill-color", "none");

    customElements.whenDefined(polygonElement.localName).then(() => {
        polygonElement.outerCoordinates = [
            ...hexagonCoordinates,
            hexagonCoordinates[0],
        ];
    });

    map3DElement.append(polygonElement);
    currentPolygon = polygonElement;

    // Retrieve latitude and longitude, handling both function and direct value cases
    const latitude =
        typeof geometry.location.lat === "function"
            ? geometry.location.lat()
            : geometry.location.lat;
    const longitude =
        typeof geometry.location.lng === "function"
            ? geometry.location.lng()
            : geometry.location.lng;

    // Add a 3D model at the center point
    const elevation = await getElevationforPoint(centerPoint);
    const model = new Model3DElement({
        src: "diamond.glb",
        position: { lat: centerLat, lng: centerLng, altitude: elevation + 100 },
        orientation: { tilt: 270 }, 
        scale: 220,
        altitudeMode: "ABSOLUTE",
    });
    map3DElement.append(model);
    currentModel = model;

    // Continuous spinning animation
    let angle = 0;
    const spinModel = () => {
        angle += 1; 
        if (angle >= 360) angle = 0;
        
        model.orientation = {
            tilt: 270, 
            heading: angle,  
        };
        requestAnimationFrame(spinModel); 
    };
    spinModel(); 

    // Smooth zoom-in effect to center and target altitude
    const targetAltitude = 1000;
    let currentAltitude = 160000;
    const zoomStep = 500;
    const zoomInterval = 5; // Time for zoom

    const zoomIn = setInterval(() => {
        if (currentAltitude > targetAltitude) {
            currentAltitude -= zoomStep;
            map3DElement.center = {
                lat: latitude,
                lng: longitude,
                altitude: currentAltitude,
            };
        } else {
            clearInterval(zoomIn); 
            popbutton(name);
        }
    }, zoomInterval);
    // closeSidebar();
};


function popbutton(name) {
    document.querySelector(".show-popup-btn").classList.remove("hidden");
    data = name;
}

function showPopup() {
    const hackathon = hackathonData[data];
    if (!hackathon) {
        console.error("Hackathon data not found for:", data);
        return;
    }

    // Update popup content with hackathon details
    const titleElement = document.querySelector(".title");
    const subtitleElement = document.querySelector(".subtitle");
    const aboutElement = document.querySelector(".section p");
    const imageElement = document.querySelector(".header-image");

    // Check each element and log if not found
    if (!titleElement) {
        console.error("Title element not found in the popup.");
        return;
    }
    if (!subtitleElement) {
        console.error("Subtitle element not found in the popup.");
        return;
    }
    if (!aboutElement) {
        console.error("About element not found in the popup.");
        return;
    }
    if (!imageElement) console.error("Image element not found.");

    // Set the content if elements are found
    titleElement.textContent = hackathon.name;
    subtitleElement.textContent = hackathon.description;
    aboutElement.innerHTML = hackathon.about;
    if (hackathon.image && imageElement) imageElement.src = hackathon.image;

    // Show the popup
    document.getElementById("popupOverlay").classList.remove("hidden");
    document.getElementById("popup").classList.remove("hidden");
}

function closePopup() {
    document.getElementById("popupOverlay").classList.add("hidden");
    document.getElementById("popup").classList.add("hidden");
}

function showLocation(name, lat, lng) {
    zoomToViewport(
        {
            location: { lat, lng },
            viewport: {
                getNorthEast: () => ({
                    lat: () => lat + 0.01,
                    lng: () => lng + 0.01,
                }),
                getSouthWest: () => ({
                    lat: () => lat - 0.01,
                    lng: () => lng - 0.01,
                }),
            },
        },
        name,
        lat,
        lng
    );
}

async function getElevationforPoint(location) {
    const { ElevationService } = await google.maps.importLibrary("elevation");
    const elevatorService = new google.maps.ElevationService();
    const elevationResponse = await elevatorService.getElevationForLocations({
        locations: [location],
    });
    if (!(elevationResponse.results && elevationResponse.results.length)) {
        window.alert(`Insufficient elevation data for place.`);
        return 10;
    }
    return elevationResponse.results[0].elevation || 10;
}

function showLocation(name, lat, lng) {
    zoomToViewport(
        {
            location: { lat, lng },
            viewport: {
                getNorthEast: () => ({
                    lat: () => lat + 0.01,
                    lng: () => lng + 0.01,
                }),
                getSouthWest: () => ({
                    lat: () => lat - 0.01,
                    lng: () => lng - 0.01,
                }),
            },
        },
        name,
        lat,
        lng
    );
}

// function togglesidebar(){
//     const sidebar = document.getElementById("sidebar");
//     const toggleButton = document.getElementById("toggle-sidebar");
  
//     // Show the sidebar
//     sidebar.classList.add("show-sidebar");
//     // toggleButton.classList.add("hidden");
  
//     // Hide the toggle button
//     // toggleButton.classList.add("hidden");
// }

// function closeSidebar() {
//     const sidebar = document.getElementById("sidebar");
//     const toggleButton = document.getElementById("toggle-sidebar");
  
//     // Hide the sidebar
//     sidebar.classList.remove("show-sidebar");
  
//     // Show the toggle button
//     // toggleButton.classList.remove("hidden");
//   }

init();
